<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Option: A</title>

    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script type="text/javascript" src="http://www.parsecdn.com/js/parse-latest.js"></script>

    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <link rel="stylesheet" href="../css/animate.css">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="css/style.css">


  </head>
  <body>

    <div class="content">

      <h1 class="nameopt animated bounceInDown" onclick="reset()" >option a</h1>
      <div class>
        <img src="images/opta.png" alt="Profile" class="logo animated fadeIn">
      </div>

      <div class="thankyou" id="thankyou">
        <p>
          Thank you for showing your interest.
        </p>
        <br>
        <input type="button" class="btn animated fadeIn btn-primary" value="Home" onclick="reset()" name="resetbtn">
      </div>

      <br>

      <div class="enterinfo animated fadeIn" id="divform">
        <form class="animated fadeIn formtext">
         Mailbox #:<br>
         <input id="boxnum" type="number" name="mailbox" class="animated fadeIn">
         <br>
         <br>
         <input type="button" class="btn animated fadeIn btn-primary" value="Go" onclick="checkID()" name="check">
         <br>
         <br>
       </form>
      </div>

      <div class="confirminfo" id="divinfo">

        <p id="namePlace" class="animated fadeIn"></p>
        <br>
        <input type="button" class="btn animated fadeIn btn-primary" value="Yes, Let's do this!" onclick="confirm()" id="confirm">
      </div>

    </div>



    <script type="text/javascript">
    reset();
    Parse.initialize("6NPizOTm1W6nP2N0Yuggy9QanFnrVty9cCtq2e0H", "aMbWw1p0foXNaKbLvFsyuFDYq3jiugoaSWrOZHub");

    var currentUser = Parse.User.current();
    var user;
    var pass;
    if (currentUser) {
        // do stuff with the user
    } else {
        user = prompt("Username");
        pass = prompt("Password");
        Parse.User.logIn(user, pass, {
          success: function(user) {
            // Do stuff after successful login.
          },
          error: function(user, error) {
            alert("Log-in Error: Refresh the Page")
          }
        });
    }

    function lougout(){
      Parse.User.logOut();
    }

      function checkID(){
        var boxnumber = document.getElementById("boxnum").value;
        var direc = Parse.Object.extend("direc");
        var query = new Parse.Query(direc);
        query.equalTo("box", parseInt(boxnumber));
        query.find({
          success: function(results) {
            if(results.length != 0) {
              var object = results[0];
              document.getElementById("namePlace").innerHTML = "Are you: " + object.get("name") + " ?";
              document.getElementById("confirm").style.visibility = "visible";
            }
            else {
              alert("No Results");
            }
          },
          error: function(error) {
            alert("Error: " + error.code + " " + error.message);
          }
        });

      }

      function confirm(){
        document.getElementById("confirm").disabled = true;
        var boxnumber = document.getElementById("boxnum").value
        var direc = Parse.Object.extend("direc");
        var query = new Parse.Query(direc);
        query.equalTo("box", parseInt(boxnumber));
        query.first({
          success: function(object) {
            var person = Parse.Object.extend("registered");
            var person = new person();

            person.set("name", object.get("name"));
            person.set("email", object.get("email"));
            person.set("person", object);

            person.save(null, {
              success: function(person) {
                // Execute any logic that should take place after the object is saved.
                document.getElementById("divform").style.display = "none";
                document.getElementById("divinfo").style.display = "none";
                document.getElementById("thankyou").style.display = "block";
              },
              error: function(person, error) {
                // Execute any logic that should take place if the save fails.
                // error is a Parse.Error with an error code and message.
                alert('Failed to create new object, with error code: ' + error.message);
              }
            });
          },
          error: function(error) {
            alert("Error: " + error.code + " " + error.message);
          }
        });
      }

      function reset(){
        document.getElementById("boxnum").value = "";
        document.getElementById("namePlace").innerHTML = "";
        document.getElementById("thankyou").style.display = "none";
        document.getElementById("confirm").style.visibility = "hidden";
        document.getElementById("divform").style.display = "inline";
        document.getElementById("divinfo").style.display = "block";
        document.getElementById("confirm").disabled = false;
      }
    </script>

  </body>
</html>
